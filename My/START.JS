const { execSync } = require("child_process");

function runCommand(cmd) {
  console.log(`\nğŸ‘‰ Running: ${cmd}`);
  try {
    execSync(cmd, { stdio: "inherit" });
  } catch (err) {
    console.error(`âŒ Failed: ${cmd}`);
    process.exit(1);
  }
}

console.log("ğŸš€ Starting production setup...");

// 1ï¸âƒ£ Install dependencies
runCommand("npm install");

// 2ï¸âƒ£ Build project for production
runCommand("npm run build");

// 3ï¸âƒ£ Install PM2 globally
runCommand("npm install -g pm2");

// 4ï¸âƒ£ Start with PM2 in production mode
runCommand("pm2 start npm --name my-nextjs-app -- run start");

// 5ï¸âƒ£ Save PM2 state so it restarts after reboot
runCommand("pm2 save");
runCommand("pm2 startup");

console.log("\nâœ… Your app is running in PRODUCTION mode!");
console.log("   ğŸŒ Access it at your server's domain or IP");
console.log("   ğŸ“œ pm2 logs my-nextjs-app   â†’ View logs");
console.log("   ğŸ›‘ pm2 stop my-nextjs-app   â†’ Stop app");
console.log("   ğŸ”„ pm2 restart my-nextjs-app â†’ Restart app");